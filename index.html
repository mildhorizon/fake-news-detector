<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Athena | Intelligent Analyzer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        gem: {
                            bg: '#0B0C0E', // Darker, deeper black
                            surface: '#151618',
                            border: '#2D2F31',
                            blue: '#8AB4F8',
                            blueGlow: 'rgba(138, 180, 248, 0.2)',
                            green: '#81C995',
                            yellow: '#FDD663',
                            red: '#F28B82',
                        }
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'scan': 'scan 2s linear infinite',
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        scan: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(300%)' }
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Scroll Background Animation */
        @keyframes scrollBackground {
            0%   { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        body.animated-bg {
            /* Fallback if image missing, nice gradient */
            background: radial-gradient(circle at top center, #1e293b, #0f172a); 
            /* Re-enable your image if you have it */
            background-image: linear-gradient(to bottom, rgba(15, 23, 42, 0.8), rgba(15, 23, 42, 0.9)), url('7.jpg');
            background-size: 120% auto;
            background-repeat: repeat-x;
            animation: scrollBackground 60s linear infinite alternate;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }

        /* Glass Utilities */
        .glass-panel {
            background: rgba(21, 22, 24, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .glass-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .glass-input:focus-within {
            background: rgba(0, 0, 0, 0.3);
            border-color: #8AB4F8;
            box-shadow: 0 0 0 2px rgba(138, 180, 248, 0.15);
        }
    </style>
</head>
<body class="text-gray-200 min-h-screen flex items-center justify-center p-4 animated-bg font-sans selection:bg-gem-blue selection:text-black">

    <div id="toast-container" class="fixed top-5 right-5 z-50 flex flex-col gap-2"></div>

    <div class="glass-panel w-full max-w-3xl rounded-2xl relative overflow-hidden">
        
        <div id="scan-line" class="absolute inset-0 z-0 pointer-events-none hidden overflow-hidden rounded-2xl">
            <div class="w-full h-20 bg-gradient-to-b from-transparent via-gem-blue/10 to-transparent animate-scan"></div>
        </div>

        <div class="relative z-10 p-6 sm:p-8">
            
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600 to-violet-600 flex items-center justify-center shadow-lg shadow-blue-900/20">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white tracking-tight">Athena <span class="text-gem-blue">AI</span></h1>
                        <div class="flex items-center gap-2">
                            <span class="relative flex h-2 w-2">
                              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                              <span class="relative inline-flex rounded-full h-2 w-2 bg-gem-green"></span>
                            </span>
                            <p class="text-xs text-gray-400 font-mono uppercase tracking-wider">System Online</p>
                        </div>
                    </div>
                </div>
                
                <div class="relative">
                    <button id="model-toggle-button" type="button" class="flex items-center gap-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg px-4 py-2 transition-all text-sm font-medium">
                        <span id="current-model-name" class="text-gem-blue">Smart 6-Way Analysis</span>
                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    
                    <div id="model-popover" class="absolute right-0 top-full mt-2 w-64 bg-[#1a1b1e] border border-gem-border rounded-xl shadow-2xl p-2 hidden z-50 origin-top-right transform transition-all">
                        <div class="space-y-1">
                            <label class="flex items-center p-2 rounded-lg hover:bg-white/5 cursor-pointer group">
                                <input type="radio" name="model-select" value="fakeddit" class="peer sr-only" checked>
                                <div class="w-full">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium text-gray-200 peer-checked:text-gem-blue">Smart 6-Way</span>
                                        <span class="w-2 h-2 rounded-full bg-gem-blue opacity-0 peer-checked:opacity-100"></span>
                                    </div>
                                    <span class="text-xs text-gray-500">Fakeddit (SVM)</span>
                                </div>
                            </label>
                            <label class="flex items-center p-2 rounded-lg hover:bg-white/5 cursor-pointer group">
                                <input type="radio" name="model-select" value="political" class="peer sr-only">
                                <div class="w-full">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium text-gray-200 peer-checked:text-gem-blue">Fast True/False</span>
                                        <span class="w-2 h-2 rounded-full bg-gem-blue opacity-0 peer-checked:opacity-100"></span>
                                    </div>
                                    <span class="text-xs text-gray-500">Political (Scikit-SVM)</span>
                                </div>
                            </label>
                            <label class="flex items-center p-2 rounded-lg hover:bg-white/5 cursor-pointer group">
                                <input type="radio" name="model-select" value="logreg" class="peer sr-only">
                                <div class="w-full">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium text-gray-200 peer-checked:text-gem-blue">Deep Logic</span>
                                        <span class="w-2 h-2 rounded-full bg-gem-blue opacity-0 peer-checked:opacity-100"></span>
                                    </div>
                                    <span class="text-xs text-gray-500">Political (Scratch LR)</span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-0">
                <div class="flex justify-between items-end mb-2 px-1">
                    <label class="text-sm font-medium text-gray-400">Content Analysis</label>
                    <div class="flex gap-2">
                         <button onclick="insertSample()" class="text-xs bg-white/5 hover:bg-white/10 border border-white/10 rounded px-2 py-1 transition-colors text-gray-400 hover:text-white" title="Insert Sample Text">
                            Sample
                        </button>
                        <button onclick="pasteText()" class="text-xs bg-white/5 hover:bg-white/10 border border-white/10 rounded px-2 py-1 transition-colors text-gray-400 hover:text-white flex items-center gap-1" title="Paste from Clipboard">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                            Paste
                        </button>
                        <button onclick="clearText()" class="text-xs bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 rounded px-2 py-1 transition-colors text-red-400 hover:text-red-300" title="Clear Text">
                            Clear
                        </button>
                    </div>
                </div>

                <div class="glass-input rounded-xl p-1 relative group">
                    <textarea 
                        id="text-input" 
                        class="w-full bg-transparent border-none text-gray-100 placeholder-gray-600 p-4 focus:ring-0 resize-none min-h-[150px] overflow-hidden font-mono text-sm leading-relaxed" 
                        placeholder="Paste article text, headlines, or claims here for verification..."
                        oninput="autoResize(this); updateCharCount(this)"></textarea>
                    
                    <div class="flex justify-between items-center px-4 pb-2 text-xs text-gray-500 border-t border-white/5 pt-2 mt-1">
                        <div class="flex items-center gap-2">
                            <span class="bg-white/10 px-1.5 py-0.5 rounded border border-white/5">Ctrl + Enter</span> to analyze
                        </div>
                        <div id="char-count">0 chars</div>
                    </div>
                </div>
            </div>

            <div class="mt-6">
                <button id="analyze-button" class="group relative w-full overflow-hidden rounded-xl bg-gem-blue p-[1px] focus:outline-none focus:ring-2 focus:ring-gem-blue focus:ring-offset-2 focus:ring-offset-gray-900">
                    <span class="absolute inset-[-1000%] animate-[spin_2s_linear_infinite] bg-[conic-gradient(from_90deg_at_50%_50%,#171717_0%,#ffffff_50%,#171717_100%)] opacity-20 group-hover:opacity-40 transition-opacity"></span>
                    <span class="inline-flex h-full w-full cursor-pointer items-center justify-center rounded-xl bg-slate-950/90 px-8 py-4 text-sm font-medium text-white backdrop-blur-3xl transition-all hover:bg-slate-950/70">
                        <div class="flex items-center gap-3">
                            <svg id="analyze-icon-default" class="w-5 h-5 text-gem-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            <svg id="analyze-icon-loading" class="animate-spin h-5 w-5 text-gem-blue hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span id="analyze-button-text" class="text-base tracking-wide">Analyze Content</span>
                        </div>
                    </span>
                </button>
            </div>

            <div id="results-container" class="mt-8 hidden animate-fade-in-up">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                        Analysis Report
                        <span class="text-xs font-normal text-gray-500 px-2 py-0.5 border border-gray-700 rounded-full" id="model-badge">Model: Fakeddit</span>
                    </h2>
                    <button onclick="copyResult()" class="text-xs text-gray-400 hover:text-white flex items-center gap-1 transition-colors" title="Copy Verdict">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                        Copy
                    </button>
                </div>
                
                <div id="results-card" class="glass-input p-6 rounded-xl border-l-4 transition-all duration-500">
                    </div>
            </div>

        </div>
    </div>

    <script>
        // --- UI & QoL Functions ---

        // 1. Auto-resize Textarea
        function autoResize(el) {
            el.style.height = 'auto';
            el.style.height = el.scrollHeight + 'px';
        }

        // 2. Character Counter
        function updateCharCount(el) {
            const count = el.value.length;
            const counter = document.getElementById('char-count');
            counter.textContent = `${count} chars`;
            if(count > 500) counter.classList.add('text-yellow-500');
            else counter.classList.remove('text-yellow-500');
        }

        // 3. Clear Text
        function clearText() {
            const el = document.getElementById('text-input');
            el.value = '';
            autoResize(el);
            updateCharCount(el);
            document.getElementById('results-container').classList.add('hidden');
            el.focus();
        }

        // 4. Paste Text
        async function pasteText() {
            try {
                const text = await navigator.clipboard.readText();
                const el = document.getElementById('text-input');
                el.value = text;
                autoResize(el);
                updateCharCount(el);
                showToast('Text pasted from clipboard', 'success');
            } catch (err) {
                showToast('Failed to paste. Check permissions.', 'error');
            }
        }

        // 5. Insert Sample
        function insertSample() {
            const samples = [
                "Scientists discover that chocolate actually reverses aging process in new clinical trial.",
                "Local government announces new tax incentives for small businesses starting next quarter.",
                "Aliens have landed in Times Square and are demanding to speak with the manager."
            ];
            const random = samples[Math.floor(Math.random() * samples.length)];
            const el = document.getElementById('text-input');
            el.value = random;
            autoResize(el);
            updateCharCount(el);
        }

        // 6. Copy Result
        function copyResult() {
            const card = document.getElementById('results-card');
            // Get just the text content cleanly
            const text = card.innerText.replace(/\n+/g, ' ').trim();
            navigator.clipboard.writeText(text).then(() => {
                showToast('Analysis copied to clipboard', 'success');
            });
        }

        // 7. Toast Notification System
        function showToast(message, type = 'default') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            let colors = 'bg-gray-800 border-gray-700 text-white';
            if (type === 'success') colors = 'bg-green-900/80 border-green-500/50 text-green-100';
            if (type === 'error') colors = 'bg-red-900/80 border-red-500/50 text-red-100';

            toast.className = `${colors} backdrop-blur-md border px-4 py-3 rounded-lg shadow-lg text-sm font-medium flex items-center gap-2 animate-fade-in-up transform transition-all duration-300`;
            toast.innerHTML = `<span>${message}</span>`;

            container.appendChild(toast);

            // Remove after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-10px)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // --- Main Logic (Preserved) ---
        
        const modelToggleButton = document.getElementById('model-toggle-button');
        const modelPopover = document.getElementById('model-popover');
        const currentModelName = document.getElementById('current-model-name');
        const modelRadios = document.querySelectorAll('input[name="model-select"]');
        
        const analyzeButton = document.getElementById('analyze-button');
        const textInput = document.getElementById('text-input');
        const resultsContainer = document.getElementById('results-container');
        const resultsCard = document.getElementById('results-card');
        const scanLine = document.getElementById('scan-line');
        
        const defaultIcon = document.getElementById('analyze-icon-default');
        const loadingIcon = document.getElementById('analyze-icon-loading');
        const buttonText = document.getElementById('analyze-button-text');

        const API_BASE_URL = 'http://127.0.0.1:8000';

        // Keyboard Shortcut
        textInput.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                analyzeButton.click();
            }
        });

        // Dropdown Logic
        modelToggleButton.addEventListener('click', (e) => {
            e.stopPropagation();
            modelPopover.classList.toggle('hidden');
        });

        document.addEventListener('click', (e) => {
            if (!modelPopover.contains(e.target) && !modelToggleButton.contains(e.target)) {
                modelPopover.classList.add('hidden');
            }
        });

        modelRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                // Find the text inside the label
                const labelDiv = radio.nextElementSibling;
                const title = labelDiv.querySelector('.font-medium').textContent;
                currentModelName.textContent = title;
                modelPopover.classList.add('hidden');
            });
        });

        // Analysis Logic
        analyzeButton.addEventListener('click', async () => {
            const selectedModel = document.querySelector('input[name="model-select"]:checked');
            const modelType = selectedModel.value;
            const text = textInput.value;

            if (!text) {
                showToast("Please enter some text first!", "error");
                textInput.focus();
                return;
            }

            // UI Loading State
            buttonText.textContent = 'Analyzing...';
            defaultIcon.classList.add('hidden');
            loadingIcon.classList.remove('hidden');
            analyzeButton.disabled = true;
            resultsContainer.classList.add('hidden');
            scanLine.classList.remove('hidden'); // Enable cool visual

            let endpoint = '';
            if (modelType === 'fakeddit') endpoint = '/analyze/fakeddit';
            else if (modelType === 'political') endpoint = '/analyze/political';
            else if (modelType === 'logreg') endpoint = '/analyze/logreg';

            try {
                const response = await fetch(API_BASE_URL + endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || 'Analysis failed');
                }

                buildResultsUI(data);
                showToast("Analysis Complete", "success");

            } catch (error) {
                showError(error.message);
                showToast("Error connecting to server", "error");
            } finally {
                // Reset UI
                buttonText.textContent = 'Analyze Content';
                defaultIcon.classList.remove('hidden');
                loadingIcon.classList.add('hidden');
                analyzeButton.disabled = false;
                scanLine.classList.add('hidden');
            }
        });

        function buildResultsUI(data) {
            let colorClass, borderColor, icon, title;

            document.getElementById('model-badge').textContent = `Model: ${data.model_used}`;

            if (data.result === 'True') {
                colorClass = 'text-gem-green';
                borderColor = 'border-gem-green';
                title = 'VERIFIED REAL';
                icon = `<svg class="w-10 h-10 ${colorClass}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>`;
            } else {
                colorClass = 'text-gem-yellow';
                borderColor = 'border-gem-yellow';
                title = 'POTENTIALLY FAKE';
                icon = `<svg class="w-10 h-10 ${colorClass}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>`;
            }

            resultsCard.className = `glass-input p-6 rounded-xl border-l-4 ${borderColor} transition-all`;
            
            resultsCard.innerHTML = `
                <div class="flex items-start gap-4">
                    <div class="bg-white/5 p-3 rounded-lg">${icon}</div>
                    <div class="flex-1">
                        <h3 class="text-2xl font-bold ${colorClass} tracking-tight">${title}</h3>
                        <p class="text-gray-400 mt-1 text-sm">Based on linguistic patterns and model confidence.</p>
                        
                        <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="bg-black/20 p-3 rounded-lg border border-white/5">
                                <div class="text-xs text-gray-500 uppercase font-semibold">Key Indicator</div>
                                <div class="text-gem-blue font-mono mt-1">${data.key_indicators[0]}</div>
                            </div>
                            <div class="bg-black/20 p-3 rounded-lg border border-white/5">
                                <div class="text-xs text-gray-500 uppercase font-semibold">Confidence</div>
                                <div class="text-gray-200 font-mono mt-1">High</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            resultsContainer.classList.remove('hidden');
            
            // Smooth scroll to results
            resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function showError(msg) {
            resultsContainer.classList.remove('hidden');
            resultsCard.className = `glass-input p-6 rounded-xl border-l-4 border-red-500`;
            resultsCard.innerHTML = `
                <div class="flex items-center gap-4">
                    <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <div>
                        <h3 class="text-lg font-bold text-red-400">System Error</h3>
                        <p class="text-gray-400 text-sm">${msg}</p>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>